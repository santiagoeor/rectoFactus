<h3 style="text-align: center;">Crear Factura</h3><br>
<div class="container">
    <form [formGroup]="myFormDataPerson">
        <div class="row">
            <div class="col-6 col-sm-4 col-md-4">
                <label for="tipoClient" class="form-label">Tipo Cliente</label>
                <select class="form-select" id="tipoClient" formControlName="typeClient">
                    <option value="">Seleccione</option>
                    <option value="1">Persona Jurídica</option>
                    <option value="2">Persona Natural</option>
                </select>
                @if (isValidField(myFormDataPerson, 'typeClient')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'typeClient') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-4">
                <label for="tipoIdentifi" class="form-label">Tipo De Identificación</label>
                <select class="form-select" id="tipoIdentifi" formControlName="typeIdentification">
                    <option value="">Seleccione</option>
                    <option value="1">Registro Civil</option>
                    <option value="2">Tarjeta de identidad</option>
                    <option value="3">Cédula de ciudadanía</option>
                    <option value="4">Tarjeta de extranjería</option>
                    <option value="5">Cédula de extranjería</option>
                    <option value="6">NIT</option>
                    <option value="7">Pasaporte</option>
                    <option value="8">Documento de identificación extranjero</option>
                    <option value="9">PEP</option>
                    <option value="10">NIT otro país</option>
                    <option value="11">NUIP</option>
                </select>
                @if (isValidField(myFormDataPerson, 'typeIdentification')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'typeIdentification') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-4">
                <label for="identificacion" class="form-label">Identificación</label>
                <input type="text" class="form-control" id="identificacion" formControlName="identification">
                @if (isValidField(myFormDataPerson, 'identification')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'identification') }}
                </app-error-forms>
                }
            </div>



            <div class="col-6 col-sm-4 col-md-4">
                <label for="name" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="name" formControlName="name">
                @if (isValidField(myFormDataPerson, 'name')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'name') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-4">
                <label for="telf" class="form-label">Teléfono</label>
                <input type="text" class="form-control" id="telf" formControlName="phone">
                @if (isValidField(myFormDataPerson, 'phone')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'phone') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-4">
                <label for="email" class="form-label">Correo</label>
                <input type="email" class="form-control" id="email" formControlName="email">
                @if (isValidField(myFormDataPerson, 'email')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'email') }}
                </app-error-forms>
                }
            </div>



            <div class="col-6 col-sm-4 col-md-4">
                <label for="municipio" class="form-label">Municipio</label>
                <select class="form-select" id="municipio" formControlName="municipality">
                    <option value="">Seleccione</option>
                    @for (item of departments(); track item.id) {
                    <option value="{{ item.id }}">{{ item.name }} {{ item.department }}</option>
                    }
                </select>
                @if (isValidField(myFormDataPerson, 'municipality')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'municipality') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-4">
                <label for="address" class="form-label">Dirección</label>
                <input type="text" class="form-control" id="address" formControlName="address">
                @if (isValidField(myFormDataPerson, 'address')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'address') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-4">
                <label for="paymenth_method" class="form-label">Método Pago</label>
                <select class="form-select" id="paymenth_method" formControlName="paymentMethod">
                    <option value="">Seleccione</option>
                    <option value="10">Efectivo</option>
                    <option value="42">Consignación</option>
                    <option value="20">Cheque</option>
                    <option value="47">Transferencia</option>
                    <option value="71">Bonos</option>
                    <option value="72">Vales</option>
                    <option value="1">Medio de pago no definido</option>
                    <option value="49">Tarjeta Débito</option>
                    <option value="48">Tarjeta Crédito</option>
                </select>
                @if (isValidField(myFormDataPerson, 'paymentMethod')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataPerson, 'paymentMethod') }}
                </app-error-forms>
                }
            </div>

        </div>
    </form>
</div>
<br><br>
<div class="container">
    <form [formGroup]="myFormDataProductInvoice">
        <div class="row">
            <div class="col-6 col-sm-4 col-md-3">
                <label for="product" class="form-label">Producto</label>
                <select class="form-select" id="product" formControlName="codeProduct">
                    <option value="">Seleccione</option>
                    @for (item of products(); track item.code_reference) {
                    <option value="{{ item.code_reference }}">{{ item.name }}</option>
                    }
                </select>
                @if (isValidField(myFormDataProductInvoice, 'codeProduct')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataProductInvoice, 'codeProduct') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-2">
                <label for="cant" class="form-label">Cantidad</label>
                <input type="number" class="form-control" id="cant" formControlName="amount">
                @if (isValidField(myFormDataProductInvoice, 'amount')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataProductInvoice, 'amount') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-3">
                <label for="discount" class="form-label">Descuento</label>
                <input type="number" class="form-control" id="discount" formControlName="discount">
                @if (isValidField(myFormDataProductInvoice, 'discount')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataProductInvoice, 'discount') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-2">
                <label for="iva" class="form-label">Aplica Iva</label>
                <select class="form-select" id="iva" formControlName="ivaApply">
                    <option value="">Seleccione</option>
                    <option value="1">Si</option>
                    <option value="0">No</option>
                </select>
                @if (isValidField(myFormDataProductInvoice, 'ivaApply')) {
                <app-error-forms>
                    {{ getFieldError(myFormDataProductInvoice, 'ivaApply') }}
                </app-error-forms>
                }
            </div>
            <div class="col-6 col-sm-4 col-md-2">
                <br>
                <button (click)="addProductInvoice()" class="btn btn-success">Agregar +</button>
            </div>
        </div>
    </form>
    <br>
    <div class="row">
        <div class="col-12 col-sm-12 col-md-12">
            <div class="scroll-table">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Producto</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Precio</th>
                            <th scope="col">Descuento</th>
                            <th scope="col">Iva %</th>
                            <th scope="col">Total</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody class="table-group-divider">
                        @for (item of productsInvoice(); track item.code_reference) {
                        <tr>
                            <th>{{ item.code_reference }}</th>
                            <th>{{ item.name }}</th>
                            <th>{{ item.quantity }}</th>
                            <th>${{ item.price / item.quantity }}</th>
                            <th>${{ item.discount }}</th>
                            <th>{{ item.tax_rate }}</th>
                            <th>${{ item.price }}</th>
                            <th><button class="btn btn-danger" (click)="deleteProductInvoice(item.code_reference)"><svg
                                        xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960"
                                        width="22px">
                                        <path
                                            d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z" />
                                    </svg></button></th>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<br>
<div class="container">
    <div class="row">
        <div class="col-6 col-sm-6 col-md-6">
            <br>
            <button (click)="redirectListInvoice()" class="btn btn-secondary">Listado Facturas</button>
        </div>
        <div class="col-2 col-sm-2 col-md-2"></div>
        <div class="col-4 col-sm-4 col-md-4">
            <br>
            <button (click)="createInvoice()" class="btn btn-primary">
                @if(loading()){
                Generando Factura...
                }@else {
                Generar Factura
                }
            </button>
        </div>
    </div>
</div>