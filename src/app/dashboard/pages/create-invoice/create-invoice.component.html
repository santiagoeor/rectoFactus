<app-best-menu></app-best-menu>
<h2 style="text-align: center;">Crear Factura</h2>
<form [formGroup]="myFormDataPerson">
    <div class="grid">
        <div class="col-6 md:col-4 lg:col-4">
            <label for="tipoClient" class="block text-900 font-medium mb-2">Tipo Cliente</label>
            <div class="select-container">
                <select class="custom-select" id="tipoClient" formControlName="typeClient">
                    <option value="">Seleccione</option>
                    <option value="1">Persona Jurídica</option>
                    <option value="2">Persona Natural</option>
                </select>
            </div>
            @if (isValidField(myFormDataPerson, 'typeClient')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'typeClient') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-4">
            <label for="tipoIdentifi" class="block text-900 font-medium mb-2">Tipo De Identificación</label>
            <div class="select-container">
                <select class="custom-select" id="tipoIdentifi" formControlName="typeIdentification">
                    <option value="">Seleccione</option>
                    <option value="1">Registro Civil</option>
                    <option value="2">Tarjeta de identidad</option>
                    <option value="3">Cédula de ciudadanía</option>
                    <option value="4">Tarjeta de extranjería</option>
                    <option value="5">Cédula de extranjería</option>
                    <option value="6">NIT</option>
                    <option value="7">Pasaporte</option>
                    <option value="8">Documento de identificación extranjero</option>
                    <option value="9">PEP</option>
                    <option value="10">NIT otro país</option>
                    <option value="11">NUIP</option>
                </select>
            </div>
            @if (isValidField(myFormDataPerson, 'typeIdentification')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'typeIdentification') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-4">
            <label for="identificacion" class="block text-900 font-medium mb-2">Identificación</label>
            <input type="text" class="p-inputtext custom-input" id="identificacion" formControlName="identification">
            @if (isValidField(myFormDataPerson, 'identification')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'identification') }}
            </app-error-forms>
            }
        </div>



        <div class="col-6 md:col-4 lg:col-4">
            <label for="name" class="block text-900 font-medium mb-2">Nombre</label>
            <input type="text" class="p-inputtext custom-input" id="name" formControlName="name">
            @if (isValidField(myFormDataPerson, 'name')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'name') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-4">
            <label for="telf" class="block text-900 font-medium mb-2">Teléfono</label>
            <input type="text" class="p-inputtext custom-input" id="telf" formControlName="phone">
            @if (isValidField(myFormDataPerson, 'phone')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'phone') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-4">
            <label for="email" class="block text-900 font-medium mb-2">Correo</label>
            <input type="email" class="p-inputtext custom-input" id="email" formControlName="email">
            @if (isValidField(myFormDataPerson, 'email')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'email') }}
            </app-error-forms>
            }
        </div>



        <div class="col-6 md:col-4 lg:col-4">
            <label for="municipio" class="block text-900 font-medium mb-2">Municipio</label>
            <div class="select-container">
                <select class="custom-select" id="municipio" formControlName="municipality">
                    <option value="">Seleccione</option>
                    @for (item of departments(); track item.id) {
                    <option value="{{ item.id }}">{{ item.name }} {{ item.department }}</option>
                    }
                </select>
            </div>
            @if (isValidField(myFormDataPerson, 'municipality')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'municipality') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-4">
            <label for="address" class="block text-900 font-medium mb-2">Dirección</label>
            <input type="text" class="p-inputtext custom-input" id="address" formControlName="address">
            @if (isValidField(myFormDataPerson, 'address')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'address') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-4">
            <label for="paymenth_method" class="block text-900 font-medium mb-2">Método Pago</label>
            <div class="select-container">
                <select class="custom-select" id="paymenth_method" formControlName="paymentMethod">
                    <option value="">Seleccione</option>
                    <option value="10">Efectivo</option>
                    <option value="42">Consignación</option>
                    <option value="20">Cheque</option>
                    <option value="47">Transferencia</option>
                    <option value="71">Bonos</option>
                    <option value="72">Vales</option>
                    <option value="1">Medio de pago no definido</option>
                    <option value="49">Tarjeta Débito</option>
                    <option value="48">Tarjeta Crédito</option>
                </select>
            </div>
            @if (isValidField(myFormDataPerson, 'paymentMethod')) {
            <app-error-forms>
                {{ getFieldError(myFormDataPerson, 'paymentMethod') }}
            </app-error-forms>
            }
        </div>

    </div>
</form>
<br><br>
<form [formGroup]="myFormDataProductInvoice">
    <div class="grid">
        <div class="col-6 md:col-4 lg:col-3">
            <label for="product" class="block text-900 font-medium mb-2">Producto</label>
            <div class="select-container">
                <select class="custom-select" id="product" formControlName="codeProduct">
                    <option value="">Seleccione</option>
                    @for (item of products(); track item.code_reference) {
                    <option value="{{ item.code_reference }}">{{ item.name }}</option>
                    }
                </select>
            </div>
            @if (isValidField(myFormDataProductInvoice, 'codeProduct')) {
            <app-error-forms>
                {{ getFieldError(myFormDataProductInvoice, 'codeProduct') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-2">
            <label for="cant" class="block text-900 font-medium mb-2">Cantidad</label>
            <input type="number" class="p-inputtext custom-input" id="cant" formControlName="amount">
            @if (isValidField(myFormDataProductInvoice, 'amount')) {
            <app-error-forms>
                {{ getFieldError(myFormDataProductInvoice, 'amount') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-3">
            <label for="discount" class="block text-900 font-medium mb-2">Descuento</label>
            <input type="number" class="p-inputtext custom-input" id="discount" formControlName="discount">
            @if (isValidField(myFormDataProductInvoice, 'discount')) {
            <app-error-forms>
                {{ getFieldError(myFormDataProductInvoice, 'discount') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-2">
            <label for="iva" class="block text-900 font-medium mb-2">Aplica Iva</label>
            <div class="select-container">
                <select class="custom-select-iva" id="iva" formControlName="ivaApply">
                    <option value="">Seleccione</option>
                    <option value="1">Si</option>
                    <option value="0">No</option>
                </select>
            </div>
            @if (isValidField(myFormDataProductInvoice, 'ivaApply')) {
            <app-error-forms>
                {{ getFieldError(myFormDataProductInvoice, 'ivaApply') }}
            </app-error-forms>
            }
        </div>
        <div class="col-6 md:col-4 lg:col-2">
            <br>
            <p-button (onClick)="addProductInvoice()" label="Agregar +"></p-button>
        </div>
    </div>
</form>
<br>
<div class="row">
    <div class="col-12 md:col-12 lg:col-12">

        <p-table [value]="productsInvoice()" [scrollable]="true" scrollHeight="250px">
            <ng-template pTemplate="header">
                <tr>
                    <th>#</th>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th>Descuento</th>
                    <th>Iva %</th>
                    <th>Total</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item>

                <tr>
                    <td>{{ item.code_reference }}</td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ item.price / item.quantity }}</td>
                    <td>${{ item.discount }}</td>
                    <td>{{ item.tax_rate }}</td>
                    <td>${{ item.price }}</td>
                    <td><p-button class="btn btn-danger" (click)="deleteProductInvoice(item.code_reference)"
                            styleClass="p-button-danger" icon="pi pi-trash"></p-button></td>
                </tr>
            </ng-template>
        </p-table>

    </div>
</div>
<br>

<div class="grid">
    <div class="col-6 md:col-6 lg:col-6">
        <br>
        <p-button (onClick)="redirectListInvoice()" label="Listado Facturas"></p-button>
    </div>
    <div class="col-2 md:col-2 lg:col-2"></div>
    <div class="col-4 md:col-4 lg:col-4">
        <br>
        <p-button (onClick)="createInvoice()">
            @if(loading()){
            Generando Factura...
            }@else {
            Generar Factura
            }
        </p-button>
    </div>
</div>